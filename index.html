<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Zen Data Sewa - Status Grouping</title><script src="https://cdn.tailwindcss.com"></script><style>@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');body{font-family:'Inter',sans-serif;background-color:#f3f4f6}.spinner{border:4px solid rgba(255,255,255,.3);border-radius:50%;border-top:4px solid #fff;width:20px;height:20px;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.status-card-mobile{transition:all .2s}.status-card-mobile:hover{transform:translateY(-2px);box-shadow:0 10px 15px -3px rgba(0,0,0,.1),0 4px 6px -2px rgba(0,0,0,.05)}}</style></head><body class="min-h-screen"><div class="container mx-auto p-4 sm:p-8"><header class="text-center mb-12"><h1 class="text-4xl font-extrabold text-gray-800 tracking-tight mb-4">Zen Data Sewa</h1><button id="toggle-admin-btn" class="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">Buka Panel Admin</button></header><div id="admin-panel" class="bg-white p-8 rounded-2xl shadow-xl mb-12 border border-gray-100 hidden transition duration-300"><div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b pb-4"><h2 id="admin-panel-title" class="text-3xl font-bold text-gray-800 mb-4 sm:mb-0">Tambah Data Akun Baru (Satu Per Satu)</h2><button type="button" onclick="confirmWipeAllData()" id="wipe-data-btn" class="px-4 py-2 bg-red-500 text-white text-sm font-bold rounded-lg shadow-md hover:bg-red-600 transition-all flex items-center justify-center min-w-[180px]"><span id="wipe-text">Hapus SEMUA Data Permanen</span><div id="wipe-loading-spinner" class="hidden spinner ml-2 border-top-4 border-white-300 w-4 h-4"></div></button></div><form id="add-data-form"><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div><label for="input-email" class="block text-sm font-semibold text-gray-700 mb-2">Email Akun</label><input type="email" id="input-email" required placeholder="misalnya: user@domain.com" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"></div><div><label for="input-periode" class="block text-sm font-semibold text-gray-700 mb-2">Periode Sewa</label><input type="text" id="input-periode" required placeholder="misalnya: W1, D5, 3 Bulan" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"><p class="text-xs text-gray-500 mt-1">Bebas: Wx, Dx, atau deskripsi lain.</p></div><div><label for="input-status" class="block text-sm font-semibold text-gray-700 mb-2">Status Akun</label><select id="input-status" required class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 bg-white appearance-none"><option value="">Pilih Status</option><option value="New Acc">New Acc</option><option value="Unrestrict">Unrestrict</option><option value="Restric">Restric</option><option value="Old acc">Old acc</option></select></div></div><button type="submit" id="submit-btn" class="mt-8 w-full px-6 py-3 bg-green-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 flex items-center justify-center"><span id="submit-text">Tambah Data Baru</span><div id="loading-spinner" class="hidden spinner ml-3"></div></button></form><div id="admin-status" class="mt-4 text-center p-3 rounded-xl hidden font-medium"></div><div class="mt-10 pt-6 border-t border-gray-300"><h3 class="text-2xl font-bold text-gray-800 mb-4">Tambah Data Massal</h3><div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-4"><div><label for="mass-input-periode" class="block text-sm font-semibold text-gray-700 mb-2">Periode Massal</label><input type="text" id="mass-input-periode" placeholder="misalnya: W10" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150"></div><div class="md:col-span-2"><label for="mass-input-status" class="block text-sm font-semibold text-gray-700 mb-2">Status Massal</label><select id="mass-input-status" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 bg-white appearance-none"><option value="">Pilih Status</option><option value="New Acc">New Acc</option><option value="Unrestrict">Unrestrict</option><option value="Restric">Restric</option><option value="Old acc">Old acc</option></select></div></div><label for="mass-email-input" class="block text-sm font-semibold text-gray-700 mb-2">Daftar Email Massal</label><textarea id="mass-email-input" rows="6" placeholder="Masukkan daftar email di sini. Pisahkan dengan baris baru atau koma." class="w-full p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 mb-4"></textarea><button type="button" onclick="handleMassSubmission(this)" id="mass-submit-btn" class="w-full px-6 py-3 bg-indigo-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-indigo-700 transition-all duration-300 flex items-center justify-center"><span id="mass-submit-text">Proses Tambah Massal</span><div id="mass-loading-spinner" class="hidden spinner ml-3"></div></button></div></div><div class="flex flex-col sm:flex-row justify-between items-center text-center sm:text-left text-xl font-bold text-gray-800 mb-8 mt-10 border-b pb-4"><span>Rekapitulasi Status Akun</span><span id="total-email-display" class="text-base font-semibold text-indigo-600 mt-2 sm:mt-0"></span></div><div id="status-card-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div><div id="status-message" class="text-center text-xl font-semibold text-gray-600 mt-12 hidden">Memuat data...</div><div class="mt-16 pt-8 border-t border-gray-300"><h2 class="text-2xl font-bold text-gray-800 mb-4">Aksi Global</h2><div class="flex flex-col space-y-4 lg:flex-row lg:space-y-0 lg:space-x-4"><button id="copy-all-emails-btn" onclick="copyAllEmailsSummary(this)" class="px-6 py-3 bg-indigo-500 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-600 transition duration-300 flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m-2 3H8m8 0v1h1a2 2 0 01-2 2H9a2 2 0 01-2-2v-1h1m8 0a2 2 0 00-2-2H8a2 2 0 00-2 2"></path></svg><span id="copy-all-text">Salin Semua Email (Ringkasan Lengkap)</span></button><button onclick="showBulkCheckerModal()" class="px-6 py-3 bg-yellow-500 text-white font-bold rounded-xl shadow-lg hover:bg-yellow-600 transition duration-300 flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2m-9 3h3m-3 3h3m-3 3h3"></path></svg><span>Identifikasi Email Massal</span></button></div></div></div><div id="details-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm"><div id="details-modal-box" class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto transform transition duration-300 scale-100"><div id="modal-content"></div><button onclick="document.getElementById('details-modal').classList.add('hidden')" class="mt-8 w-full py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition duration-300">Tutup Detail</button></div></div><div id="bulk-checker-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm"><div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto transform transition duration-300 scale-100"><h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Identifikasi Email Massal</h3><div class="mb-4"><label for="bulk-action-select" class="block text-sm font-semibold text-gray-700 mb-2">Pilih Aksi Massal:</label><select id="bulk-action-select" class="w-full px-3 py-2 border border-gray-300 rounded-xl bg-white focus:ring-yellow-500 focus:border-yellow-yellow-500"><option value="identify">Hanya Identifikasi (Lihat Status)</option><option value="New Acc">Ubah Status ke New Acc</option><option value="Unrestrict">Ubah Status ke Unrestrict</option><option value="Restric">Ubah Status ke Restric</option><option value="Old acc">Ubah Status ke Old acc</option></select></div><textarea id="bulk-email-input" rows="8" placeholder="Masukkan daftar email di sini. Pisahkan dengan baris baru atau koma (misalnya: email1@a.com, email2@b.com)" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 mb-4"></textarea><button onclick="processBulkEmails()" class="w-full py-3 bg-yellow-500 text-white font-bold rounded-xl shadow-lg hover:bg-yellow-600 transition-all duration-300" id="process-bulk-btn">Mulai Identifikasi</button><div id="bulk-checker-results" class="mt-6 p-4 bg-gray-50 rounded-xl hidden"></div><button onclick="document.getElementById('bulk-checker-modal').classList.add('hidden');document.getElementById('bulk-checker-results').classList.add('hidden')" class="mt-4 w-full py-3 bg-gray-200 text-gray-700 font-semibold rounded-xl hover:bg-gray-300 transition duration-300">Tutup</button></div></div><script>const BIN_ID='68efcb87d0ea881f40a4ce97';const API_KEY='$2a$10$CyEgkHrw6xtwHt.RE3ZqEulgvcK5yzSmlYJmn.aRA23csA9a8u/.2';const MAX_RETRIES=3;const DELAY_MS=1000;const STATUS_TYPES=['New Acc','Unrestrict','Restric','Old acc'];const RENDER_ORDER=['New Acc','Unrestrict','Old acc','Restric'];let groupedData={};let allRecords=[];let isEditing=false;let editingIndex=-1;const statusCardGrid=document.getElementById('status-card-grid');const statusMessage=document.getElementById('status-message');const adminPanel=document.getElementById('admin-panel');const toggleAdminBtn=document.getElementById('toggle-admin-btn');const addDataForm=document.getElementById('add-data-form');const adminStatus=document.getElementById('admin-status');const submitBtn=document.getElementById('submit-btn');const submitText=document.getElementById('submit-text');const loadingSpinner=document.getElementById('loading-spinner');const inputPeriode=document.getElementById('input-periode');const modalContent=document.getElementById('modal-content');const detailsModal=document.getElementById('details-modal');const adminPanelTitle=document.getElementById('admin-panel-title');const inputEmail=document.getElementById('input-email');const inputStatus=document.getElementById('input-status');const totalEmailDisplay=document.getElementById('total-email-display');const wipeDataBtn=document.getElementById('wipe-data-btn');const wipeText=document.getElementById('wipe-text');const wipeLoadingSpinner=document.getElementById('wipe-loading-spinner');const bulkCheckerModal=document.getElementById('bulk-checker-modal');const bulkEmailInput=document.getElementById('bulk-email-input');const bulkCheckerResults=document.getElementById('bulk-checker-results');const processBulkBtn=document.getElementById('process-bulk-btn');const bulkActionSelect=document.getElementById('bulk-action-select');const massEmailInput=document.getElementById('mass-email-input');const massInputPeriode=document.getElementById('mass-input-periode');const massInputStatus=document.getElementById('mass-input-status');const massSubmitBtn=document.getElementById('mass-submit-btn');const massSubmitText=document.getElementById('mass-submit-text');const massLoadingSpinner=document.getElementById('mass-loading-spinner');async function apiCallWithRetry(url,options,maxRetries=MAX_RETRIES){for(let i=0;i<maxRetries;i++){try{const finalOptions={mode:'cors',...options};const response=await fetch(url,finalOptions);if(!response.ok){const errorText=await response.text();console.error(`API Error Response Text: ${errorText}`);throw new Error(`Kesalahan HTTP ${response.status}: Periksa API Key atau izin. Pesan API: ${errorText}`);}return await response.json();}catch(error){console.error(`Percobaan ke-${i+1} gagal:`,error.message);if(i===maxRetries-1){throw error;}const delay=DELAY_MS*Math.pow(2,i);await new Promise(resolve=>setTimeout(resolve,delay));}}}const API_URL=`https://api.jsonbin.io/v3/b/${BIN_ID}`;async function saveRecordsToBin(records){const payload=records.length===0?[{_meta:"empty"}]:records;const putOptions={method:'PUT',headers:{'X-Master-Key':API_KEY,'Content-Type':'application/json','X-Bin-Private':'false'},body:JSON.stringify(payload)};await apiCallWithRetry(API_URL,putOptions);}function getStatusProps(status){switch(status){case 'New Acc':return {color:'bg-indigo-600 text-white',icon:'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z',badge:'bg-indigo-100 text-indigo-800'};case 'Unrestrict':return {color:'bg-teal-500 text-white',icon:'M9 12l2 2 4-4m5.66 4.34a8 8 0 11-13.32-4.34',badge:'bg-teal-100 text-teal-800'};case 'Restric':return {color:'bg-rose-600 text-white',icon:'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z',badge:'bg-rose-100 text-rose-800'};case 'Old acc':return {color:'bg-slate-500 text-white',icon:'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z',badge:'bg-slate-100 text-slate-800'};default:return {color:'bg-gray-400 text-white',icon:'M8.228 9.247a3.5 3.5 0 100 4.506zM11 11a1 1 0 10-2 0 1 1 0 002 0z',badge:'bg-gray-100 text-gray-800'};}}function groupDataByStatus(records){const groups={};STATUS_TYPES.forEach(status=>{groups[status]=[];});groups['Lain-lain']=[];records.forEach(item=>{const status=item.status||'Lain-lain';if(STATUS_TYPES.includes(status)){groups[status].push(item);}else{groups['Lain-lain'].push(item);}});return groups;}function findItemIndex(uniqueId){return allRecords.findIndex(item=>item.uniqueId==uniqueId);}function prepareEdit(encodedItem){const item=JSON.parse(decodeURIComponent(encodedItem));inputEmail.value=item.email;inputPeriode.value=item.tanggal;inputStatus.value=item.status;isEditing=true;editingIndex=findItemIndex(item.uniqueId);adminPanelTitle.textContent='Edit Data Akun';submitText.textContent='Simpan Perubahan';submitBtn.classList.remove('bg-green-600','bg-gray-500');submitBtn.classList.add('bg-blue-600');adminPanel.classList.remove('hidden');toggleAdminBtn.textContent='Tutup Panel Edit';toggleAdminBtn.classList.remove('bg-indigo-600');toggleAdminBtn.classList.add('bg-gray-500');detailsModal.classList.add('hidden');window.scrollTo({top:0,behavior:'smooth'});}function confirmDelete(uniqueId){if(window.confirm(`Apakah Anda yakin ingin menghapus akun ini? Tindakan ini tidak dapat dibatalkan.`)){deleteItem(uniqueId);}}async function deleteItem(uniqueId){submitBtn.disabled=true;try{const indexToDelete=findItemIndex(uniqueId);if(indexToDelete===-1){throw new Error("Data yang akan dihapus tidak ditemukan. Coba muat ulang halaman.");}const newRecords=[...allRecords];newRecords.splice(indexToDelete,1);await saveRecordsToBin(newRecords);showAdminStatus("Data berhasil dihapus!",true);detailsModal.classList.add('hidden');loadData();}catch(error){console.error("Kesalahan saat menghapus data tunggal:",error);showAdminStatus(`Gagal menghapus data: ${error.message}`,false);}finally{submitBtn.disabled=false;}}function confirmWipeAllData(){if(allRecords.length===0){showAdminStatus('Tidak ada data untuk dihapus.',false);return;}if(window.confirm(`PERINGATAN! Anda akan menghapus SEMUA (${allRecords.length}) data secara permanen. Lanjutkan?`)){if(window.confirm("KONFIRMASI AKHIR: Apakah Anda BENAR-BENAR yakin ingin menghapus SEMUA data?")){wipeAllData();}}}function setWipeLoading(isLoading){wipeDataBtn.disabled=isLoading;if(isLoading){wipeText.textContent='Menghapus...';wipeLoadingSpinner.classList.remove('hidden');}else{wipeText.textContent='Hapus SEMUA Data Permanen';wipeLoadingSpinner.classList.add('hidden');}}async function wipeAllData(){setWipeLoading(true);try{await saveRecordsToBin([]);showAdminStatus("SEMUA DATA BERHASIL DIHAPUS PERMANEN.",true);resetAdminPanelState();loadData();}catch(error){console.error("Kesalahan saat menghapus semua data:",error);showAdminStatus(`Gagal menghapus semua data: ${error.message}`,false);}finally{setWipeLoading(false);}}async function handleFormSubmission(event){event.preventDefault();setSubmitLoading(true);const email=inputEmail.value;const status=inputStatus.value;const tanggal=inputPeriode.value.trim();if(!tanggal||!status||!email){showAdminStatus('Harap isi semua kolom formulir (Email, Periode, Status).',false);setSubmitLoading(false);return;}const isAddMode=!isEditing||editingIndex===-1;const newDataEntry={email:email,tanggal:tanggal,status:status,uniqueId:isAddMode?Date.now().toString():allRecords[editingIndex].uniqueId,timestamp:new Date().toISOString()};try{let records=[...allRecords];if(isEditing&&editingIndex!==-1){records[editingIndex]=newDataEntry;await saveRecordsToBin(records);showAdminStatus('Data berhasil diubah dan disimpan!',true);resetAdminPanelState();}else{records.push(newDataEntry);await saveRecordsToBin(records);showAdminStatus('Data berhasil ditambahkan dan disimpan!',true);}addDataForm.reset();loadData();}catch(error){console.error("Kesalahan saat menyimpan/mengubah data:",error);showAdminStatus(`Gagal menyimpan data: ${error.message}`,false);}finally{setSubmitLoading(false);}}function resetAdminPanelState(){isEditing=false;editingIndex=-1;adminPanelTitle.textContent='Tambah Data Akun Baru (Satu Per Satu)';submitText.textContent='Tambah Data Baru';submitBtn.classList.remove('bg-blue-600','bg-gray-500');submitBtn.classList.add('bg-green-600');addDataForm.reset();}function copyEmailsByStatus(statusKey,buttonElement){const list=groupedData[statusKey];if(!list||list.length===0){showAdminStatus(`Tidak ada email di status "${statusKey}" untuk disalin.`,false);return;}const emails=list.map(item=>item.email).join('\n');const tempTextArea=document.createElement('textarea');tempTextArea.value=emails;document.body.appendChild(tempTextArea);tempTextArea.select();document.execCommand('copy');document.body.removeChild(tempTextArea);const originalText=buttonElement.innerHTML;buttonElement.innerHTML='✅ Berhasil Disalin!';buttonElement.classList.remove('bg-gray-100','text-gray-700');buttonElement.classList.add('bg-green-500','text-white');setTimeout(()=>{buttonElement.innerHTML=originalText;buttonElement.classList.remove('bg-green-500','text-white');buttonElement.classList.add('bg-gray-100','text-gray-700');},2000);}function copyAllEmailsSummary(buttonElement){const summary=[];RENDER_ORDER.forEach(statusKey=>{const emails=groupedData[statusKey]?.map(item=>item.email).join('\n')||'';if(emails.length>0){summary.push(`${statusKey} 👇🏻\n${emails}\n`);}});const finalSummary=summary.join('\n');if(finalSummary.trim()===''){showAdminStatus('Tidak ada data email yang ditemukan untuk disalin.',false);return;}const tempTextArea=document.createElement('textarea');tempTextArea.value=finalSummary;document.body.appendChild(tempTextArea);tempTextArea.select();document.execCommand('copy');document.body.removeChild(tempTextArea);const originalText=buttonElement.innerHTML;buttonElement.innerHTML='✅ Berhasil Disalin!';buttonElement.classList.remove('bg-indigo-500','hover:bg-indigo-600');buttonElement.classList.add('bg-green-600','hover:bg-green-700');setTimeout(()=>{buttonElement.innerHTML=originalText;buttonElement.classList.remove('bg-green-600','hover:bg-green-700');buttonElement.classList.add('bg-indigo-500','hover:bg-indigo-600');},2000);}function showBulkCheckerModal(){bulkCheckerModal.classList.remove('hidden');bulkCheckerResults.classList.add('hidden');bulkEmailInput.value='';}async function processBulkEmails(){const selectedAction=bulkActionSelect.value;const rawInput=bulkEmailInput.value.trim();if(!rawInput){alert('Harap masukkan daftar email.');return;}processBulkBtn.disabled=true;processBulkBtn.innerHTML='Memproses...';bulkCheckerResults.classList.add('hidden');const inputEmails=rawInput.split(/[\n,;\s]+/).map(e=>e.trim().toLowerCase()).filter(e=>e.length>0&&e.includes('@'));const emailsToProcess=new Set(inputEmails);const matchedRecords=[];const notFoundEmails=[];const currentRecordMap=new Map(allRecords.map(r=>[r.email.toLowerCase(),r]));let updateCount=0;let updatedRecords=[...allRecords];const emailMap=new Map(updatedRecords.map(r=>[r.uniqueId,r]));const uniqueEmailsInList=new Set();inputEmails.forEach(email=>{if(!uniqueEmailsInList.has(email)){uniqueEmailsInList.add(email);const record=currentRecordMap.get(email);if(record){matchedRecords.push(record);}else{notFoundEmails.push(email);}}});let recordsChanged=false;if(selectedAction!=='identify'){updatedRecords=updatedRecords.map(record=>{const recordEmail=record.email.toLowerCase();if(emailsToProcess.has(recordEmail)&&record.status!==selectedAction){updateCount++;recordsChanged=true;return {...record,status:selectedAction};}return record;});}const matches={};RENDER_ORDER.forEach(status=>{matches[status]=[];});matchedRecords.forEach(record=>{const status=record.status||'Lain-lain';if(selectedAction!=='identify'){if(record.status===selectedAction){matches[selectedAction].push(record.email.toLowerCase());}}else{matches[status].push(record.email.toLowerCase());}});let resultsHtml=`<h4 class="text-xl font-bold mb-4">Hasil Aksi Massal (${inputEmails.length} Email)</h4>`;if(selectedAction!=='identify'){resultsHtml+=`<p class="mb-4">Status Target: <span class="text-blue-600 font-extrabold">${selectedAction}</span> | Total Akun Diubah: <span class="text-green-600 font-extrabold">${updateCount}</span></p>`;}else{resultsHtml+=`<p class="mb-4">Total Email Cocok: <span class="text-green-600 font-extrabold">${matchedRecords.length}</span> | Tidak Ditemukan: <span class="text-red-600 font-extrabold">${notFoundEmails.length}</span></p>`;}if(selectedAction!=='identify'&&updateCount>0){try{await saveRecordsToBin(updatedRecords);await loadData();resultsHtml+=`<div class="p-3 bg-green-100 text-green-800 rounded-xl font-bold mb-4">✅ ${updateCount} akun berhasil diubah statusnya menjadi ${selectedAction}. Data di atas sudah diperbarui.</div>`;}catch(error){resultsHtml+=`<div class="p-3 bg-red-100 text-red-800 rounded-xl font-bold mb-4">❌ Gagal menyimpan perubahan status massal: ${error.message}.</div>`;}}if(selectedAction==='identify'){RENDER_ORDER.forEach(status=>{const emails=matches[status].length>0?matches[status]:matchedRecords.filter(r=>r.status===status).map(r=>r.email.toLowerCase());const count=emails.length;if(count>0){const statusProps=getStatusProps(status);resultsHtml+=`<div class="mb-4 p-3 ${statusProps.badge} rounded-xl"><p class="font-bold">${status} (${count} Email):</p><textarea rows="${Math.min(5,count+1)}" readonly class="w-full text-sm mt-2 p-2 border border-gray-300 rounded-lg resize-none">${emails.join('\n')}</textarea></div>`;}});}if(notFoundEmails.length>0){resultsHtml+=`<div class="mb-4 p-3 bg-gray-100 text-gray-800 rounded-xl"><p class="font-bold">Tidak Ditemukan (${notFoundEmails.length} Email):</p><textarea rows="${Math.min(5,notFoundEmails.length+1)}" readonly class="w-full text-sm mt-2 p-2 border border-gray-300 rounded-lg resize-none">${notFoundEmails.join('\n')}</textarea></div>`;}bulkCheckerResults.innerHTML=resultsHtml;bulkCheckerResults.classList.remove('hidden');processBulkBtn.disabled=false;processBulkBtn.innerHTML='Mulai Identifikasi';}function showDetailsModal(statusKey){const list=groupedData[statusKey];const isAdminMode=!adminPanel.classList.contains('hidden');if(!list||list.length===0){modalContent.innerHTML=`<h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">Akun Status: ${statusKey}</h3><p class="text-center py-4 text-gray-600">Tidak ada akun dengan status ini.</p>`;detailsModal.classList.remove('hidden');return;}const listHeaderHtml=isAdminMode?`<div class="grid grid-cols-10 text-xs font-semibold text-gray-500 border-b pb-2 mb-2 px-3"><div class="col-span-6">EMAIL AKUN</div><div class="col-span-2 text-center">PERIODE</div><div class="col-span-2 text-center">AKSI</div></div>`:`<h4 class="text-xl font-bold text-gray-700 mb-4 border-b pb-2">Daftar Akun (${list.length})</h4>`;const accountListHtml=list.map(item=>{const periodeValue=item.tanggal&&item.tanggal.trim()!==' ' ?item.tanggal:'Kosong';const uniqueId=item.uniqueId;const encodedItem=encodeURIComponent(JSON.stringify(item));const actionContent=isAdminMode?`<div class="flex justify-center space-x-1"><button onclick="prepareEdit('${encodedItem}')" class="p-1 text-xs text-white bg-blue-500 rounded-md hover:bg-blue-600 transition duration-150 flex items-center justify-center min-w-[45px]">Edit</button><button onclick="confirmDelete('${uniqueId}')" class="p-1 text-xs text-white bg-red-500 rounded-md hover:bg-red-600 transition duration-150 flex items-center justify-center min-w-[45px]">Hapus</button></div>`:`<span class="text-xs italic text-gray-400">Lihat</span>`;return `<div class="grid grid-cols-10 items-center py-3 px-3 border-b border-gray-100 hover:bg-indigo-50 transition duration-150 rounded-lg"><div class="col-span-6 text-sm font-medium text-gray-900 break-words pr-2">${item.email||'N/A'}</div><div class="col-span-2 text-sm font-bold text-indigo-700 text-center">${periodeValue}</div><div class="col-span-2 text-center">${actionContent}</div></div>`;}).join('');modalContent.innerHTML=`<h3 class="text-2xl font-bold text-gray-800 mb-6 border-b pb-3">${statusKey} (${list.length} Akun)</h3><div class="p-2 bg-gray-50 rounded-lg shadow-inner">${listHeaderHtml}<div class="space-y-1">${accountListHtml}</div></div>`;detailsModal.classList.remove('hidden');}function createStatusCard(status,count){const {color,icon}=getStatusProps(status);return `<div class="status-card-mobile bg-white p-6 rounded-2xl shadow-lg border border-gray-100 transition duration-300 hover:shadow-xl"><div class="flex items-center justify-between mb-4"><div class="flex items-center"><span class="p-3 rounded-full ${color} mr-3"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${icon}"></path></svg></span><h3 class="text-xl font-bold text-gray-700">${status}</h3></div></div><div class="flex flex-col border-t border-gray-100 pt-4 mt-4 space-y-2"><div class="flex items-center justify-between"><div class="flex flex-col"><span class="text-4xl font-extrabold text-gray-900">${count}</span><span class="text-sm font-medium text-gray-500">Total Akun</span></div><button onclick="showDetailsModal('${status}')" class="flex items-center text-sm font-semibold text-indigo-600 hover:text-indigo-800 transition duration-300">Lihat Detail<svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg></button></div><button onclick="copyEmailsByStatus('${status}', this)" class="w-full py-1 text-xs font-semibold rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-200">Salin Semua Email</button></div></div>`;}async function loadData(){statusMessage.textContent='Memuat data...';statusMessage.classList.remove('hidden');statusCardGrid.innerHTML='';totalEmailDisplay.innerHTML='';const options={method:'GET',headers:{'X-Master-Key':API_KEY}};try{const data=await apiCallWithRetry(`${API_URL}/latest`,options);const rawRecords=data.record||[];const records=rawRecords.filter(item=>!item._meta).map(item=>({...item,uniqueId:item.uniqueId||Date.now().toString()+Math.random().toString(36).substr(2,5)}));allRecords=records;const totalEmails=allRecords.length;totalEmailDisplay.innerHTML=`Total Akun: <span class="text-2xl font-extrabold">${totalEmails}</span>`;groupedData=groupDataByStatus(allRecords);if(totalEmails===0){statusMessage.textContent='Tidak ada data yang ditemukan. Silakan tambahkan melalui Panel Admin.';statusMessage.classList.remove('hidden');return;}statusMessage.classList.add('hidden');let cardHtml='';RENDER_ORDER.forEach(statusKey=>{const count=groupedData[statusKey].length;cardHtml+=createStatusCard(statusKey,count);});if(groupedData['Lain-lain']&&groupedData['Lain-lain'].length>0){cardHtml+=createStatusCard('Lain-lain',groupedData['Lain-lain'].length);}statusCardGrid.innerHTML=cardHtml;}catch(error){console.error("Kesalahan Fatal dalam memuat data:",error);statusMessage.textContent=`Gagal memuat data: ${error.message}. Coba periksa Bin ID/API Key.`;statusMessage.classList.remove('hidden');}}function toggleAdminPanel(){const isHidden=adminPanel.classList.contains('hidden');if(isHidden){adminPanel.classList.remove('hidden');toggleAdminBtn.textContent='Tutup Panel Admin';toggleAdminBtn.classList.remove('bg-indigo-600');toggleAdminBtn.classList.add('bg-gray-500');}else{adminPanel.classList.add('hidden');toggleAdminBtn.textContent='Buka Panel Admin';toggleAdminBtn.classList.remove('bg-gray-500');toggleAdminBtn.classList.add('bg-indigo-600');resetAdminPanelState();}}function showAdminStatus(message,isSuccess=true){adminStatus.textContent=message;adminStatus.classList.remove('hidden','bg-red-100','text-red-800','bg-green-100','text-green-800','bg-blue-100','text-blue-800');if(isSuccess){adminStatus.classList.add('bg-green-100','text-green-800');}else{adminStatus.classList.add('bg-red-100','text-red-800');}if(message.includes("Kesalahan HTTP 401")){setTimeout(()=>adminStatus.classList.remove('hidden'),500);}else{setTimeout(()=>adminStatus.classList.add('hidden'),5000);}}function setSubmitLoading(isLoading){submitBtn.disabled=isLoading;if(isLoading){submitText.textContent='Memproses...';loadingSpinner.classList.remove('hidden');}else{if(!isEditing){submitText.textContent='Tambah Data Baru';}else if(isEditing){submitText.textContent='Simpan Perubahan';}loadingSpinner.classList.add('hidden');}}function setMassSubmitLoading(isLoading){massSubmitBtn.disabled=isLoading;if(isLoading){massSubmitText.textContent='Memproses...';massLoadingSpinner.classList.remove('hidden');}else{massSubmitText.textContent='Proses Tambah Massal';massLoadingSpinner.classList.add('hidden');}}async function handleMassSubmission(buttonElement){const status=massInputStatus.value;const periode=massInputPeriode.value.trim();const rawEmails=massEmailInput.value.trim();if(!status||!periode||!rawEmails){showAdminStatus('Harap isi Status, Periode Massal, dan Daftar Email.',false);return;}const emails=rawEmails.split(/[\n,;\s]+/).map(e=>e.trim()).filter(e=>e.length>0&&e.includes('@'));if(emails.length===0){showAdminStatus('Daftar email tidak valid atau kosong.',false);return;}setMassSubmitLoading(true);try{const newRecords=emails.map(email=>({email:email,tanggal:periode,status:status,uniqueId:Date.now().toString()+Math.random().toString(36).substr(2,5),timestamp:new Date().toISOString()}));const recordsToSave=[...allRecords,...newRecords];await saveRecordsToBin(recordsToSave);showAdminStatus(`✅ Berhasil menambahkan ${newRecords.length} data secara massal!`,true);massEmailInput.value='';loadData();}catch(error){console.error("Kesalahan saat menyimpan data massal:",error);showAdminStatus(`❌ Gagal menyimpan data massal: ${error.message}`,false);}finally{setMassSubmitLoading(false);}}loadData();toggleAdminBtn.addEventListener('click',toggleAdminPanel);addDataForm.addEventListener('submit',handleFormSubmission);wipeDataBtn.addEventListener('click',confirmWipeAllData);</script></body></html>
